<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the Bayesian Adaptive Sampling (BAS) Package for Bayesian Model Averaging and Variable Selection • BAS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Using the Bayesian Adaptive Sampling (BAS) Package for Bayesian Model Averaging and Variable Selection">
<meta property="og:description" content="BAS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BAS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/merliseclyde">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/merliseclyde/BAS">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the Bayesian Adaptive Sampling (BAS) Package for Bayesian Model Averaging and Variable Selection</h1>
                        <h4 class="author">Merlise A Clyde</h4>
            
            <h4 class="date">2020-08-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/merliseclyde/BAS/blob/master/vignettes/BAS-vignette.Rmd"><code>vignettes/BAS-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>BAS-vignette.Rmd</code></div>

    </div>

    
    
<p>The <code>BAS</code> package provides easy to use functions to implement Bayesian Model Averaging in linear models and generalized linear models. Prior distributions on coefficients are based on Zellner’s g-prior or mixtures of g-priors, such as the Zellner-Siow Cauchy prior or mixtures of g-priors from <a href="https://dx.doi.org/10.1198/016214507000001337">Liang et al (2008)</a> for linear models, as well as other options including AIC, BIC, RIC and Empirical Bayes methods. Extensions to Generalized Linear Models are based on the mixtures of g-priors in GLMs of <a href="https://dx.doi.org/10.1080/01621459.2018.1469992">Li and Clyde (2019)</a> using an integrated Laplace approximation.</p>
<p><code>BAS</code> uses an adaptive sampling algorithm to sample without replacement from the space of models or MCMC sampling which is recommended for sampling problems with a large number of predictors. See <a href="https://dx.doi.org/10.1198/jcgs.2010.09049">Clyde, Littman &amp; Ghosh</a> for more details for the sampling algorithms.</p>
<div id="installing-bas" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-bas" class="anchor"></a>Installing BAS</h2>
<p>The stable version can be installed easily in the <code>R</code> console like any other package:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"BAS"</span>)</pre></body></html></div>
<p>On the other hand, I welcome everyone to use the most recent version of the package with quick-fixes, new features and probably new bugs. To get the latest development version from <a href="https://github.com/merliseclyde">GitHub</a>, use the <code>devtools</code> package from <a href="https://cran.r-project.org/package=devtools">CRAN</a> and enter in <code>R</code>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu">install_github</span>(<span class="st">"merliseclyde/BAS"</span>)</pre></body></html></div>
<p>As the package does depend on BLAS and LAPACK, installing from GitHub will require that you have FORTRAN and C compilers on your system.</p>
</div>
<div id="demo" class="section level2">
<h2 class="hasAnchor">
<a href="#demo" class="anchor"></a>Demo</h2>
<p>We will use the UScrime data to illustrate some of the commands and functionality.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">UScrime</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"MASS"</span>)</pre></body></html></div>
<p>Following other analyses, we will go ahead and log transform all of the variables except column 2, which is the indicator variable of the state being a southern state.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">UScrime</span>[, -<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">UScrime</span>[, -<span class="fl">2</span>])</pre></body></html></div>
<p>To get started, we will use <code>BAS</code> with the Zellner-Siow Cauchy prior on the coefficients.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">BAS</span>)
<span class="no">crime.ZS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">y</span> ~ <span class="no">.</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">UScrime</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"ZS-null"</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(), <span class="kw">initprobs</span> <span class="kw">=</span> <span class="st">"eplogp"</span>,
  <span class="kw">force.heredity</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">pivot</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)</pre></body></html></div>
<p><code>BAS</code> uses a model formula similar to <code>lm</code> to specify the full model with all of the potential predictors. Here we are using the shorthand <code>.</code> to indicate that all remaining variables in the data frame provided by the <code>data</code> argument. Different prior distributions on the regression coefficients may be specified using the <code>prior</code> argument, and include</p>
<ul>
<li>“BIC”</li>
<li>"AIC</li>
<li>“g-prior”</li>
<li>“hyper-g”</li>
<li>“hyper-g-laplace”</li>
<li>“hyper-g-n”</li>
<li>“JZS”</li>
<li>“ZS-null”</li>
<li>“ZS-full”</li>
<li>“EB-local”</li>
<li>“EB-global”</li>
</ul>
<p>where the default is the Zellner-Siow prior, ZS-null, where all Bayes factors are compared to the null model. The newest prior option, “JZS”, also corresponds to the Zellner-Siow prior on the coefficients, but uses numerical integration rather than a Laplace approximation to obtain the marginal likelihood of models.</p>
<p>By default, <code>BAS</code> will try to enumerate all models if <span class="math inline">\(p &lt; 19\)</span> using the default <code>method="BAS"</code>. The prior distribution over the models is a <code><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform()</a></code> distribution which assigns equal probabilities to all models. The last optional argument <code>initprobs = eplogp</code> provides a way to initialize the sampling algorithm and order the variables in the tree structure that represents the model space in BAS. The <code>eplogp</code> option uses the Bayes factor calibration of p-values <span class="math inline">\(-e p \log(p)\)</span> to provide an approximation to the marginal inclusion probability that the coefficient of each predictor is zero, using the p-values from the full model. Other options for <code>initprobs</code> include</p>
<ul>
<li>“marg-eplogp”"</li>
<li>“uniform”</li>
<li>numeric vector of length p</li>
</ul>
<p>The option “marg-eplogp” uses p-values from the <span class="math inline">\(p\)</span> simple linear regressions (useful for large p or highly correlated variables).</p>
<p>Since we are enumerating under all possible models these options are not important and the <code>method="deterministic"</code> may be faster if there are no factors or interactions in the model.</p>
</div>
<div id="plots" class="section level2">
<h2 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h2>
<p>Some graphical summaries of the output may be obtained by the <code>plot</code> function</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">crime.ZS</span>, <span class="kw">ask</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/unnamed-chunk-1-1.png" width="700"><img src="BAS-vignette_files/figure-html/unnamed-chunk-1-2.png" width="700"><img src="BAS-vignette_files/figure-html/unnamed-chunk-1-3.png" width="700"><img src="BAS-vignette_files/figure-html/unnamed-chunk-1-4.png" width="700"></p>
<p>which produces a panel of four plots. The first is a plot of residuals and fitted values under Bayesian Model Averaging. Ideally, if our model assumptions hold, we will not see outliers or non-constant variance. The second plot shows the cumulative probability of the models in the order that they are sampled. This plot indicates that the cumulative probability is leveling off as each additional model adds only a small increment to the cumulative probability, while earlier, there are larger jumps corresponding to discovering a new high probability model. The third plot shows the dimension of each model (the number of regression coefficients including the intercept) versus the log of the marginal likelihood of the model. The last plot shows the marginal posterior inclusion probabilities (pip) for each of the covariates, with marginal pips greater than 0.5 shown in red. The variables with pip &gt; 0.5 correspond to what is known as the median probability model. Variables with high inclusion probabilities are generally important for explaining the data or prediction, but marginal inclusion probabilities may be small if there are predictors that are highly correlated, similar to how p-values may be large in the presence of multicollinearity.</p>
<p>Individual plots may be obtained using the <code>which</code> option.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">crime.ZS</span>, <span class="kw">which</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">ask</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">caption</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">sub.caption</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/pip-1.png" width="480"></p>
<p><code>BAS</code> has <code>print</code> and <code>summary</code> methods defined for objects of class <code>bas</code>. Typing the objects name</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">crime.ZS</span></pre></body></html></div>
<pre><code>## 
## Call:
## bas.lm(formula = y ~ ., data = UScrime, prior = "ZS-null", modelprior = uniform(), 
##     initprobs = "eplogp", force.heredity = FALSE, pivot = TRUE)
## 
## 
##  Marginal Posterior Inclusion Probabilities: 
## Intercept          M         So         Ed        Po1        Po2         LF  
##    1.0000     0.8536     0.2737     0.9747     0.6652     0.4490     0.2022  
##       M.F        Pop         NW         U1         U2        GDP       Ineq  
##    0.2050     0.3696     0.6944     0.2526     0.6149     0.3601     0.9965  
##      Prob       Time  
##    0.8992     0.3718</code></pre>
<p>returns a summary of the marginal inclusion probabilities, while the <code>summary</code> function provides</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">width</span> <span class="kw">=</span> <span class="fl">80</span>)
<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/summary.html">summary</a></span>(<span class="no">crime.ZS</span>)</pre></body></html></div>
<pre><code>##           P(B != 0 | Y)  model 1    model 2    model 3   model 4    model 5
## Intercept     1.0000000  1.00000  1.0000000  1.0000000  1.000000  1.0000000
## M             0.8535720  1.00000  1.0000000  1.0000000  1.000000  1.0000000
## So            0.2737083  0.00000  0.0000000  0.0000000  0.000000  0.0000000
## Ed            0.9746605  1.00000  1.0000000  1.0000000  1.000000  1.0000000
## Po1           0.6651553  1.00000  1.0000000  0.0000000  1.000000  1.0000000
## Po2           0.4490097  0.00000  0.0000000  1.0000000  0.000000  0.0000000
## LF            0.2022374  0.00000  0.0000000  0.0000000  0.000000  0.0000000
## M.F           0.2049659  0.00000  0.0000000  0.0000000  0.000000  0.0000000
## Pop           0.3696150  0.00000  0.0000000  0.0000000  1.000000  0.0000000
## NW            0.6944069  1.00000  1.0000000  1.0000000  1.000000  0.0000000
## U1            0.2525834  0.00000  0.0000000  0.0000000  0.000000  0.0000000
## U2            0.6149388  1.00000  1.0000000  1.0000000  1.000000  1.0000000
## GDP           0.3601179  0.00000  0.0000000  0.0000000  0.000000  0.0000000
## Ineq          0.9965359  1.00000  1.0000000  1.0000000  1.000000  1.0000000
## Prob          0.8991841  1.00000  1.0000000  1.0000000  1.000000  1.0000000
## Time          0.3717976  1.00000  0.0000000  0.0000000  0.000000  0.0000000
## BF                   NA  1.00000  0.9416178  0.6369712  0.594453  0.5301269
## PostProbs            NA  0.01820  0.0172000  0.0116000  0.010800  0.0097000
## R2                   NA  0.84200  0.8265000  0.8229000  0.837500  0.8046000
## dim                  NA  9.00000  8.0000000  8.0000000  9.000000  7.0000000
## logmarg              NA 23.65111 23.5909572 23.2000822 23.130999 23.0164741</code></pre>
<p>a list of the top 5 models (in terms of posterior probability) with the zero-one indicators for variable inclusion. The other columns in the summary are the Bayes factor of each model to the highest probability model (hence its Bayes factor is 1), the posterior probabilities of the models, the ordinary <span class="math inline">\(R^2\)</span> of the models, the dimension of the models (number of coefficients including the intercept) and the log marginal likelihood under the selected prior distribution.</p>
</div>
<div id="visualization-of-the-model-space" class="section level2">
<h2 class="hasAnchor">
<a href="#visualization-of-the-model-space" class="anchor"></a>Visualization of the Model Space</h2>
<p>To see beyond the first five models, we can represent the collection of the models via an <code>image</code> plot. By default this shows the top 20 models.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/image.bas.html">image</a></span>(<span class="no">crime.ZS</span>, <span class="kw">rotate</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/image-1.png" width="480"></p>
<p>This image has rows that correspond to each of the variables and intercept, with labels for the variables on the y-axis. The x-axis corresponds to the possible models. These are sorted by their posterior probability from best at the left to worst at the right with the rank on the top x-axis.</p>
<p>Each column represents one of the 16 models. The variables that are excluded in a model are shown in black for each column, while the variables that are included are colored, with the color related to the log posterior probability. The color of each column is proportional to the log of the posterior probabilities (the lower x-axis) of that model. The log posterior probabilities are actually scaled so that the 0 corresponds to the lowest probability model in the top 20, so that the values on the axis correspond to log Bayes factors for comparing each model the lowest probability model in the top 20 models. Models that are the same color have similar log Bayes factors which allows us to view models that are clustered together that have Bayes Factors where the differences are not “worth a bare mention”.</p>
<p>This plot indicates that the police expenditure in the two years do not enter the model together, and is an indication of the high correlation between the two variables.</p>
</div>
<div id="posterior-distributions-of-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#posterior-distributions-of-coefficients" class="anchor"></a>Posterior Distributions of Coefficients</h2>
<p>To examine the marginal distributions of the two coefficients for the police expenditures, we can extract the coefficients estimates and standard deviations under BMA.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">coef.ZS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/coef.html">coef</a></span>(<span class="no">crime.ZS</span>)</pre></body></html></div>
<p>an optional argument, <code>n.models</code> to <code>coef</code> will use only the top <code>n.models</code> for BMA and may be more computationally efficient for large problems.</p>
<p>Plots of the posterior distributions averaging over all of the models are obtained using the <code>plot</code> method for the <code>bas</code> coefficient object.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">coef.ZS</span>, <span class="kw">subset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>:<span class="fl">6</span>), <span class="kw">ask</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/plot-1.png" width="700"><img src="BAS-vignette_files/figure-html/plot-2.png" width="700"></p>
<p>The vertical bar represents the posterior probability that the coefficient is 0 while the bell shaped curve represents the density of plausible values from all the models where the coefficient is non-zero. This is scaled so that the height of the density for non-zero values is the probability that the coefficient is non-zero. Omitting the <code>subset</code> argument provides all of the marginal distributions.</p>
<p>To obtain credible intervals for coefficients, <code>BAS</code> includes a <code>confint</code> method to create Highest Posterior Density intervals from the summaries from <code>coef</code>.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/confint.coef.html">confint</a></span>(<span class="no">coef.ZS</span>)</pre></body></html></div>
<pre><code>##                    2.5%       97.5%        beta
## Intercept  6.6692652472 6.781139142  6.72493620
## M          0.0000000000 2.176878656  1.14359433
## So        -0.0541438475 0.300012268  0.03547522
## Ed         0.6496476704 3.161317269  1.85848834
## Po1       -0.0005918646 1.418253324  0.60067372
## Po2       -0.1768065927 1.459419202  0.31841766
## LF        -0.4477555124 1.095719805  0.05933737
## M.F       -2.3204669946 1.773989783 -0.02702786
## Pop       -0.1254514704 0.006827109 -0.02248283
## NW         0.0000000000 0.163227178  0.06668437
## U1        -0.4814825708 0.356871155 -0.02456854
## U2         0.0000000000 0.673647628  0.20702927
## GDP       -0.0268362734 1.216031781  0.20625063
## Ineq       0.6610447202 2.095474820  1.39012647
## Prob      -0.4133393253 0.000000000 -0.21536203
## Time      -0.5346720890 0.026772339 -0.08433479
## attr(,"Probability")
## [1] 0.95
## attr(,"class")
## [1] "confint.bas"</code></pre>
<p>where the third column is the posterior mean. This uses Monte Carlo sampling to draw from the mixture model over coefficient where models are sampled based on their posterior probabilities.</p>
<p>We can also plot these via</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/confint.coef.html">confint</a></span>(<span class="no">coef.ZS</span>, <span class="kw">parm</span> <span class="kw">=</span> <span class="fl">2</span>:<span class="fl">16</span>))</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/plot-confint-1.png" width="672"></p>
<pre><code>## NULL</code></pre>
<p>using the <code>parm</code> argument to select which coefficients to plot (the intercept is <code>parm=1</code>).</p>
<p>For estimation under selection, <code>BAS</code> supports additional arguments via <code>estimator</code>. The default is <code>estimator="BMA"</code> which uses all models or <code>n.models</code>. Other options include estimation under the highest probability model</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/confint.coef.html">confint</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/coef.html">coef</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"HPM"</span>)))</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<pre><code>## NULL</code></pre>
<p>or the median probability model</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/confint.coef.html">confint</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/coef.html">coef</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"MPM"</span>)))</pre></body></html></div>
<p>where variables that are excluded have distributions that are point masses at zero under selection.</p>
</div>
<div id="prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction" class="anchor"></a>Prediction</h2>
<p><code>BAS</code> has methods defined to return fitted values, <code>fitted</code>, using the observed design matrix and predictions at either the observed data or potentially new values, <code>predict</code>, as with <code>lm</code>.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">muhat.BMA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/fitted.html">fitted</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"BMA"</span>)
<span class="no">BMA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/predict.bas.html">predict</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"BMA"</span>)

<span class="co"># predict has additional slots for fitted values under BMA, predictions under each model</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">BMA</span>)</pre></body></html></div>
<pre><code>##  [1] "fit"         "Ybma"        "Ypred"       "postprobs"   "se.fit"     
##  [6] "se.pred"     "se.bma.fit"  "se.bma.pred" "df"          "best"       
## [11] "bestmodel"   "best.vars"   "estimator"</code></pre>
<p>Plotting the two sets of fitted values,</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">3</span>, <span class="fl">3</span>))
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">muhat.BMA</span>, <span class="no">BMA</span>$<span class="no">fit</span>,
  <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">16</span>,
  <span class="kw">xlab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span>(<span class="no">mu</span>[<span class="no">i</span>])), <span class="kw">ylab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">hat</a></span>(<span class="no">Y</span>[<span class="no">i</span>]))
)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="fl">0</span>, <span class="fl">1</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>we see that they are in perfect agreement. That is always the case as the posterior mean for the regression mean function at a point <span class="math inline">\(x\)</span> is the expected posterior predictive value for <span class="math inline">\(Y\)</span> at <span class="math inline">\(x\)</span>. This is true not only for estimators such as BMA, but the expected values under model selection.</p>
<div id="inference-with-model-selection" class="section level3">
<h3 class="hasAnchor">
<a href="#inference-with-model-selection" class="anchor"></a>Inference with model selection</h3>
<p>In addition to using BMA, we can use the posterior means under model selection. This corresponds to a decision rule that combines estimation and selection. <code>BAS</code> currently implements the following options</p>
<p><strong>highest probability model:</strong></p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">HPM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/predict.bas.html">predict</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"HPM"</span>)

<span class="co"># show the indices of variables in the best model where 0 is the intercept</span>
<span class="no">HPM</span>$<span class="no">bestmodel</span></pre></body></html></div>
<pre><code>## [1]  0  1  3  4  9 11 13 14 15</code></pre>
<p>A little more interpretable version with names:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/variable.names.pred.bas.html">variable.names</a></span>(<span class="no">HPM</span>)</pre></body></html></div>
<pre><code>## [1] "Intercept" "M"         "Ed"        "Po1"       "NW"        "U2"       
## [7] "Ineq"      "Prob"      "Time"</code></pre>
<p><strong>median probability model:</strong></p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">MPM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/predict.bas.html">predict</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"MPM"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/variable.names.pred.bas.html">variable.names</a></span>(<span class="no">MPM</span>)</pre></body></html></div>
<pre><code>## [1] "Intercept" "M"         "Ed"        "Po1"       "NW"        "U2"       
## [7] "Ineq"      "Prob"</code></pre>
<p>This is the model where all predictors have an inclusion probability greater than or equal to 0.5. This coincides with the HPM if the predictors are all mutually orthogonal, and in this case is the best predictive model under squared error loss.</p>
<p>Note that we can also extract the best model from the attribute in the fitted values as well.</p>
<p><strong>best predictive model:</strong></p>
<p>In general, the HPM or MPM are not the best predictive models, which from a Bayesian decision theory perspective would be the model that is closest to BMA predictions under squared error loss.</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">BPM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/predict.bas.html">predict</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"BPM"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/variable.names.pred.bas.html">variable.names</a></span>(<span class="no">BPM</span>)</pre></body></html></div>
<pre><code>##  [1] "Intercept" "M"         "So"        "Ed"        "Po1"       "Po2"      
##  [7] "M.F"       "NW"        "U2"        "Ineq"      "Prob"</code></pre>
<p>Let’s see how they compare:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="kw pkg">GGally</span><span class="kw ns">::</span><span class="fu"><a href="https://ggobi.github.io/ggally/reference/ggpairs.html">ggpairs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">HPM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">HPM</span>$<span class="no">fit</span>), <span class="co"># this used predict so we need to extract fitted values</span>
  <span class="kw">MPM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">MPM</span>$<span class="no">fit</span>), <span class="co"># this used fitted</span>
  <span class="kw">BPM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">BPM</span>$<span class="no">fit</span>), <span class="co"># this used fitted</span>
  <span class="kw">BMA</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="no">BMA</span>$<span class="no">fit</span>)
)) <span class="co"># this used predict</span></pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Using the <code>se.fit = TRUE</code> option with <code>predict</code> we can also calculate standard deviations for prediction or for the mean and use this as input for the <code>confint</code> function for the prediction object.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">BPM</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/predict.bas.html">predict</a></span>(<span class="no">crime.ZS</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"BPM"</span>, <span class="kw">se.fit</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">crime.conf.fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/confint.coef.html">confint</a></span>(<span class="no">BPM</span>, <span class="kw">parm</span> <span class="kw">=</span> <span class="st">"mean"</span>)
<span class="no">crime.conf.pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/confint.coef.html">confint</a></span>(<span class="no">BPM</span>, <span class="kw">parm</span> <span class="kw">=</span> <span class="st">"pred"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">crime.conf.fit</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/se-1.png" width="672"></p>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">crime.conf.pred</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/se-2.png" width="672"></p>
<pre><code>## NULL</code></pre>
<p>For prediction at new points, we can supply a new dataframe to the predict function as in <code>lm</code>.</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">new.pred</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/predict.bas.html">predict</a></span>(<span class="no">crime.ZS</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">UScrime</span>, <span class="kw">estimator</span> <span class="kw">=</span> <span class="st">"MPM"</span>)</pre></body></html></div>
</div>
</div>
<div id="alternative-algorithms" class="section level2">
<h2 class="hasAnchor">
<a href="#alternative-algorithms" class="anchor"></a>Alternative algorithms</h2>
<p><code>BAS</code> has several options for sampling from the model space with or without enumeration. The (current) default <code>method="BAS"</code> samples models without replacement using estimates of the marginal inclusion probabilities using the algorithm described in <a href="https://dx.doi.org/10.1198/jcgs.2010.09049">Clyde et al (2011)</a>. The initial sampling probabilities provided by <code>initprobs</code> are updated based on the sampled models, every <code>update</code> iterations. This can be more efficient in some cases if a large fraction of the model space has been sampled, however, in cases of high correlation and a large number of predictors, this can lead to biased estimates <a href="https://dx.doi.org/10.1093/biomet/ass040">Clyde and Ghosh (2012)</a>, in which case MCMC is preferred. The <code>method="MCMC"</code> is described below and is better for large <span class="math inline">\(p\)</span>.</p>
<p>A deterministic sampling scheme is also available for enumeration;</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">10</span>) {
    <span class="no">crime.ZS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">y</span> ~ <span class="no">.</span>,
      <span class="kw">data</span> <span class="kw">=</span> <span class="no">UScrime</span>,
      <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"ZS-null"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"BAS"</span>,
      <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(), <span class="kw">initprobs</span> <span class="kw">=</span> <span class="st">"eplogp"</span>
    )
  }
)</pre></body></html></div>
<pre><code>##    user  system elapsed 
##   2.024   0.012   2.037</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">10</span>) {
    <span class="no">crime.ZS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">y</span> ~ <span class="no">.</span>,
      <span class="kw">data</span> <span class="kw">=</span> <span class="no">UScrime</span>,
      <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"ZS-null"</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"deterministic"</span>,
      <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(), <span class="kw">initprobs</span> <span class="kw">=</span> <span class="st">"eplogp"</span>
    )
  }
)</pre></body></html></div>
<pre><code>##    user  system elapsed 
##   1.623   0.000   1.623</code></pre>
<p>which is faster for enumeration than the default method=“BAS”.</p>
</div>
<div id="beyond-enumeration" class="section level2">
<h2 class="hasAnchor">
<a href="#beyond-enumeration" class="anchor"></a>Beyond Enumeration</h2>
<p>Many problems are too large to enumerate all possible models. In such cases we may use the <code>method="BAS"</code> to sample without replacement or the <code>method="MCMC"</code> option to sample models using Markov Chain Monte Carlo sampling to sample models based on their posterior probabilities. For spaces where the number of models greatly exceeds the number of models to sample, the MCMC option is recommended as it provides estimates with low bias compared to the sampling without replacement of BAS (Clyde and Ghosh 2011).</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">crime.ZS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">y</span> ~ <span class="no">.</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">UScrime</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"ZS-null"</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(),
  <span class="kw">method</span> <span class="kw">=</span> <span class="st">"MCMC"</span>
)</pre></body></html></div>
<p>This will run the MCMC sampler until the number of unique sampled models exceeds <code>n.models</code> which is <span class="math inline">\(2^p\)</span> (if <span class="math inline">\(p &lt; 19\)</span>) by default or until <code>MCMC.iterations</code> has been exceeded, where <code>MCMC.iterations = n.models*2</code> by default.</p>
<div id="estimates-of-marginal-posterior-inclusion-probabilities-pip" class="section level3">
<h3 class="hasAnchor">
<a href="#estimates-of-marginal-posterior-inclusion-probabilities-pip" class="anchor"></a>Estimates of Marginal Posterior Inclusion Probabilities (pip)</h3>
<p>With MCMC sampling there are two estimates of the marginal inclusion probabilities: <code>object$probne0</code> which are obtained by using the re-normalized posterior odds from sampled models to estimate probabilities and the estimates based on Monte Carlo frequencies <code>object$probs.MCMC</code>. These should be in close agreement if the MCMC sampler has run for enough iterations.</p>
<p><code>BAS</code> includes a diagnostic function to compare the two sets of estimates of posterior inclusion probabilities and posterior model probabilities</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/diagnostics.html">diagnostics</a></span>(<span class="no">crime.ZS</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"pip"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">16</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/diagnostics-1.png" width="700"></p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/diagnostics.html">diagnostics</a></span>(<span class="no">crime.ZS</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"model"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">16</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/diagnostics-2.png" width="700"></p>
<p>In the left hand plot of pips, each point represents one posterior inclusion probability for the 15 variables estimated under the two methods. The two estimators are in pretty close agreement. The plot of the model probabilities suggests that we should use more <code>MCMC.iterations</code> if we want more accurate estimates of the posterior model probabilities.</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">crime.ZS</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">y</span> ~ <span class="no">.</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">UScrime</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"ZS-null"</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(),
  <span class="kw">method</span> <span class="kw">=</span> <span class="st">"MCMC"</span>, <span class="kw">MCMC.iterations</span> <span class="kw">=</span> <span class="fl">10</span>^<span class="fl">6</span>
)

<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/diagnostics.html">diagnostics</a></span>(<span class="no">crime.ZS</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"model"</span>, <span class="kw">pch</span><span class="kw">=</span><span class="fl">16</span>)</pre></body></html></div>
</div>
</div>
<div id="outliers" class="section level2">
<h2 class="hasAnchor">
<a href="#outliers" class="anchor"></a>Outliers</h2>
<p>BAS can also be used for exploring mean shift or variance inflation outliers by adding indicator variables for each case being an outlier (the mean is not given by the regression) or not. This is similar to the MC3.REG function in BMA, although here we are using a g-prior or mixture of g-priors for the coefficients for the outlier means.</p>
<p>Using the Stackloss data, we can add an identify matrix to the original dataframe, where each column is an indicator that the ith variable is an outlier.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"stackloss"</span>)
<span class="no">stackloss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">stackloss</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">stackloss</span>)))
<span class="no">stack.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">stack.loss</span> ~ <span class="no">.</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">stackloss</span>,
  <span class="kw">method</span> <span class="kw">=</span> <span class="st">"MCMC"</span>, <span class="kw">initprobs</span> <span class="kw">=</span> <span class="st">"marg-eplogp"</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"ZS-null"</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/tr.poisson.html">tr.poisson</a></span>(<span class="fl">4</span>, <span class="fl">10</span>),
  <span class="kw">MCMC.iterations</span> <span class="kw">=</span> <span class="fl">200000</span>
)</pre></body></html></div>
<p>The above call introduces using truncated prior distributions on the model space; in this case the distribution of the number of variables to be included has a Poisson distribution, with mean 4 (under no truncation), and the truncation point is at 10, so that all models with more than 10 (one half of cases rounded down) will have probability zero. This avoids exploration of models that are not full rank.</p>
<p>Looking at the summaries</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="kw pkg">knitr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/summary.html">summary</a></span>(<span class="no">stack.bas</span>)))</pre></body></html></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">P(B != 0 | Y)</th>
<th align="right">model 1</th>
<th align="right">model 2</th>
<th align="right">model 3</th>
<th align="right">model 4</th>
<th align="right">model 5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">1.000000</td>
<td align="right">1.00000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">Air.Flow</td>
<td align="right">0.998960</td>
<td align="right">1.00000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">Water.Temp</td>
<td align="right">0.471750</td>
<td align="right">1.00000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">Acid.Conc.</td>
<td align="right">0.088625</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>1</code></td>
<td align="right">0.594190</td>
<td align="right">1.00000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>2</code></td>
<td align="right">0.166080</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>3</code></td>
<td align="right">0.629575</td>
<td align="right">1.00000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>4</code></td>
<td align="right">0.945975</td>
<td align="right">1.00000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>5</code></td>
<td align="right">0.067245</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>6</code></td>
<td align="right">0.076775</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>7</code></td>
<td align="right">0.065410</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>8</code></td>
<td align="right">0.068260</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>9</code></td>
<td align="right">0.066415</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>10</code></td>
<td align="right">0.064285</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>11</code></td>
<td align="right">0.065485</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>12</code></td>
<td align="right">0.086655</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>13</code></td>
<td align="right">0.340145</td>
<td align="right">0.00000</td>
<td align="right">1.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>14</code></td>
<td align="right">0.191435</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>15</code></td>
<td align="right">0.072625</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>16</code></td>
<td align="right">0.055430</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>17</code></td>
<td align="right">0.068155</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>18</code></td>
<td align="right">0.067490</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>19</code></td>
<td align="right">0.090665</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left"><code>20</code></td>
<td align="right">0.133180</td>
<td align="right">0.00000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left"><code>21</code></td>
<td align="right">0.984650</td>
<td align="right">1.00000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">BF</td>
<td align="right">NA</td>
<td align="right">1.00000</td>
<td align="right">0.3397571</td>
<td align="right">0.5555328</td>
<td align="right">0.2016282</td>
<td align="right">0.5779604</td>
</tr>
<tr class="odd">
<td align="left">PostProbs</td>
<td align="right">NA</td>
<td align="right">0.06190</td>
<td align="right">0.0230000</td>
<td align="right">0.0218000</td>
<td align="right">0.0191000</td>
<td align="right">0.0191000</td>
</tr>
<tr class="even">
<td align="left">R2</td>
<td align="right">NA</td>
<td align="right">0.98920</td>
<td align="right">0.9873000</td>
<td align="right">0.9922000</td>
<td align="right">0.9803000</td>
<td align="right">0.9923000</td>
</tr>
<tr class="odd">
<td align="left">dim</td>
<td align="right">NA</td>
<td align="right">7.00000</td>
<td align="right">7.0000000</td>
<td align="right">8.0000000</td>
<td align="right">6.0000000</td>
<td align="right">8.0000000</td>
</tr>
<tr class="even">
<td align="left">logmarg</td>
<td align="right">NA</td>
<td align="right">23.82319</td>
<td align="right">22.7436630</td>
<td align="right">23.2353597</td>
<td align="right">22.2218573</td>
<td align="right">23.2749373</td>
</tr>
</tbody>
</table>
</div>
<div id="factors-and-hierarchical-heredity" class="section level2">
<h2 class="hasAnchor">
<a href="#factors-and-hierarchical-heredity" class="anchor"></a>Factors and Hierarchical Heredity</h2>
<p>BAS now includes constraints for factors so that all terms that represent a factor are either included or excluded together. To illustrate, we will use the data set <code>ToothGrowth</code> and convert <code>dose</code> to a factor:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">ToothGrowth</span>)
<span class="no">ToothGrowth</span>$<span class="no">dose</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">ToothGrowth</span>$<span class="no">dose</span>)
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">ToothGrowth</span>$<span class="no">dose</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>)</pre></body></html></div>
<p>and fit the model of main effects and two way interaction without any constraints:</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">TG.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">len</span> ~ <span class="no">supp</span>*<span class="no">dose</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">ToothGrowth</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"BAS"</span>
)

<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/image.bas.html">image</a></span>(<span class="no">TG.bas</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>From the image of the model space, we see that levels of a factor enter or drop from the model independently and that interactions may be included without the main effects. This may lead to more parsimonious models, however, the hypotheses that are being tested about the coefficients that represent the factor depend on the choice for the reference group. To force levels of a factor to enter or leave together we can use <code>force.heredity = TRUE</code>.</p>
<p>The <code>force.heredity</code> option also forces interactions to be included only if the main effects are also included, or for models with several factors and higher order interactions, the heredity constraint implies that all lower order interactions must be included before adding higher order interactions.</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">TG.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">len</span> ~ <span class="no">supp</span> * <span class="no">dose</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">ToothGrowth</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"BAS"</span>, <span class="kw">force.heredity</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)

<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/image.bas.html">image</a></span>(<span class="no">TG.bas</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>The <code>force.heredity</code> is set to FALSE for the sampling methods <code>MCMC+BAS</code> and <code>deterministic</code>. If there are more than 20 predictors and factors, then we recommend using <code>MCMC</code> to enforce the constraints. Alternatively, there is a function, <code>force.heredity.bas</code>, to post-process the output to drop models that violate the hierarchical heredity constraint:</p>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="no">TG.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">len</span> ~ <span class="no">supp</span> * <span class="no">dose</span>,
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">ToothGrowth</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(), <span class="kw">method</span> <span class="kw">=</span> <span class="st">"BAS"</span>, <span class="kw">force.heredity</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)
<span class="no">TG.herid.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/force.heredity.bas.html">force.heredity.bas</a></span>(<span class="no">TG.bas</span>)</pre></body></html></div>
<p>that can be used with those sampling methods.</p>
</div>
<div id="weighted-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#weighted-regression" class="anchor"></a>Weighted Regression</h2>
<p><code>BAS</code> can perform weighted regression by supplying an optional weight vector that is of the same length as the response where the assumption is that the variance of the response is proportional to 1/weights. The g-prior incorporates the weights in the prior covariance, <span class="math display">\[
 \sigma^2 g (X_\gamma^T W X_\gamma)^{-1}
\]</span> where <span class="math inline">\(X_\gamma\)</span> is the design matrix under model <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(W\)</span> is the <span class="math inline">\(n \times n\)</span> diagonal matrix with the weights on the diagonal.</p>
<p>To illustrate, we will use the climate data, available at the url below</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">climate</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"BAS"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">climate</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    63 obs. of  5 variables:
##  $ deltaT  : num  -2.6 -2.6 -2.9 -2.4 -2.8 -1.2 -2.4 -2.6 -2.4 -2.5 ...
##  $ sdev    : num  0.7 0.8 0.9 0.7 0.7 0.3 1.3 1.3 1.3 0.5 ...
##  $ proxy   : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ T.M     : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ latitude: num  2.5 2.2 0.5 0.3 0.2 -1.1 5.2 11.4 14.6 6.3 ...</code></pre>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/summary.html">summary</a></span>(<span class="no">climate</span>)</pre></body></html></div>
<pre><code>##      deltaT            sdev            proxy            T.M        
##  Min.   :-7.000   Min.   :0.1500   Min.   :1.000   Min.   :0.0000  
##  1st Qu.:-3.900   1st Qu.:0.5000   1st Qu.:2.000   1st Qu.:1.0000  
##  Median :-2.900   Median :0.7000   Median :3.000   Median :1.0000  
##  Mean   :-3.111   Mean   :0.8579   Mean   :3.333   Mean   :0.8254  
##  3rd Qu.:-2.000   3rd Qu.:1.3000   3rd Qu.:5.000   3rd Qu.:1.0000  
##  Max.   : 0.200   Max.   :2.5000   Max.   :8.000   Max.   :1.0000  
##     latitude      
##  Min.   :-22.500  
##  1st Qu.: -3.450  
##  Median :  0.200  
##  Mean   :  2.187  
##  3rd Qu.:  9.700  
##  Max.   : 29.000</code></pre>
<p>which includes measurements of changes in temperature (<code>deltaT</code>) at various <code>latitude</code>s as well as a measure of the accuracy of the measured values <code>sdev</code> for 8 different types <code>proxy</code> of obtaining measurements. We will use this to explore weighted regression and the option to group terms in factors or from <code>poly</code>. For illustration purposes, we will eliminate <code>proxy == 6</code> which has only one level as the interactions are not estimable, and then convert <code>proxy</code> to a factor.</p>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="no">climate</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">climate</span>, <span class="no">proxy</span> <span class="kw">!=</span> <span class="fl">6</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">proxy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">proxy</span>))</pre></body></html></div>
<p>We can fit a weighted regression with <code>weights = 1/sdev^2</code> with the following code</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">climate.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">deltaT</span> ~ <span class="no">proxy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="no">latitude</span>, <span class="fl">2</span>),
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">climate</span>,
  <span class="kw">weights</span> <span class="kw">=</span> <span class="fl">1</span> / <span class="no">sdev</span>^<span class="fl">2</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"hyper-g-n"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">3.0</span>,
  <span class="kw">n.models</span> <span class="kw">=</span> <span class="fl">2</span>^<span class="fl">20</span>,
  <span class="kw">force.heredity</span><span class="kw">=</span><span class="fl">TRUE</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>()
)</pre></body></html></div>
<p>Examining the image of the top models,</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/BAS/man/image.bas.html">image</a></span>(<span class="no">climate.bas</span>, <span class="kw">rotate</span> <span class="kw">=</span> <span class="no">F</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/climate-image-1.png" width="672"></p>
<p>we see that all levels of a factor enter or drop from the model together, as well as the vectors in the design matrix to represent the term <code>poly</code>.<br>
Rerunning without the constraint,</p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="co"># May take a while to enumerate all 2^20 models</span>
<span class="no">climate.bas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/bas.lm.html">bas.lm</a></span>(<span class="no">deltaT</span> ~ <span class="no">proxy</span> * <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="no">latitude</span>, <span class="fl">2</span>),
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">climate</span>,
  <span class="kw">weights</span> <span class="kw">=</span> <span class="fl">1</span> / <span class="no">sdev</span>^<span class="fl">2</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="st">"hyper-g-n"</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">3.0</span>,
  <span class="kw">n.models</span> <span class="kw">=</span> <span class="fl">2</span>^<span class="fl">20</span>,
  <span class="kw">modelprior</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BAS/man/uniform.html">uniform</a></span>(),
  <span class="kw">force.heredity</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)
<span class="fu"><a href="https://rdrr.io/pkg/BAS/man/image.bas.html">image</a></span>(<span class="no">climate.bas</span>)</pre></body></html></div>
<p><img src="BAS-vignette_files/figure-html/wtreg-wo-contraint-1.png" width="672"></p>
<p>allows one to see which factors levels are different from the reference group.</p>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p><code>BAS</code> includes other prior distributions on coefficients and models, as well as <code>bas.glm</code> for fitting Generalized Linear Models. The syntax for <code>bas.glm</code> and <code>bas.lm</code> are not yet the same, particularly for how some of the priors on coefficients are represented, so please see the documentation for more features and details until this is updated or another vignette is added!</p>
<p>For issues or feature requests please submit via the package’s github page <a href="https://github.com/merliseclyde/BAS">merliseclyde/BAS</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://stat.duke.edu/~clyde">Merlise Clyde</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '94a8229a313e5475acdeffd26558ce98',
    indexName: 'bas',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
